<!--index.wxml-->
<view class="container">
  <!-- è½®æ’­å›¾éƒ¨åˆ† -->
  <view class="swiper-container">
    <swiper class="swiper" autoplay interval="5000" circular indicator-dots indicator-active-color="#FFFFFF" indicator-color="rgba(255, 255, 255, 0.6)">
      <swiper-item wx:for="{{swiperList}}" wx:key="id">
        <image src="{{item.url}}" mode="aspectFill"></image>
      </swiper-item>
    </swiper>
    <view class="restaurant-info">
      <image class="logo" src="/images/logo.png"></image>
      <text class="restaurant-name">ç±³èŒé…’å®¶</text>
    </view>
    <view class="opening-hours">
      <text class="hours-text">å¼€åº—æ—¶é—´ 10:00-22:00</text>
    </view>
    <view class="group-buy-info">
      <text class="group-buy-text">æ”¯æŒç¾å›¢ã€æŠ–éŸ³ã€å¾®ä¿¡å°ç¨‹åºçš„å›¢è´­ä¸‹å•</text>
    </view>
    <view class="parking-discount">
      <text class="parking-text">è¿›åº—æ¶ˆè´¹å³å¯å…åœè½¦è´¹ï¼Œæ¶ˆè´¹æ»¡500å…ƒæ‰“8æŠ˜</text>
    </view>
  </view>

  <!-- èœå•éƒ¨åˆ† -->
  <view class="menu-container">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <scroll-view class="category-list" scroll-y>
      <view 
        class="category-item {{currentCategory === index ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="switchCategory"
        data-index="{{index}}"
      >
        {{item.name}}
      </view>
    </scroll-view>

    <!-- å¼€å‘ç¯å¢ƒä¸‹çš„è°ƒè¯•ä¿¡æ¯ -->
    <view class="debug-info" wx:if="{{false}}">
      <text>å½“å‰åˆ†ç±»: {{currentCategory}}</text>
      <text>èœå“æ•°é‡: {{dishes.length}}</text>
    </view>
    
    <!-- å³ä¾§èœå“åˆ—è¡¨ -->
    <scroll-view class="dish-list" scroll-y>
      <view wx:if="{{!dishes || dishes.length === 0}}" class="no-data">
        <text>æš‚æ— èœå“æ•°æ®</text>
      </view>
      <block wx:else>
        <view wx:for="{{dishes}}" wx:key="id" class="dish-item">
          <image class="dish-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="dish-info">
            <text class="dish-name">{{item.name}}</text>
            <text class="dish-desc">{{item.description}}</text>
            <view class="dish-bottom">
              <text class="dish-price">Â¥{{item.price}}</text>
              <view class="dish-control">
                <view class="minus" bindtap="minusCount" data-id="{{item.id}}" wx:if="{{item.count > 0}}">-</view>
                <text class="count" wx:if="{{item.count > 0}}">{{item.count}}</text>
                <view class="plus" bindtap="addCount" data-id="{{item.id}}">+</view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- è´­ç‰©è½¦è¯¦æƒ…é¢æ¿ -->
  <view class="cart-panel {{showCartPanel ? 'show' : ''}}" catchtap="hideCartPanel">
    <view class="cart-panel-content" catchtap="stopPropagation">
      <view class="cart-panel-header">
        <text class="cart-panel-title">è´­ç‰©è½¦</text>
        <view class="cart-panel-clear" bindtap="clearCart">
          <text class="clear-icon">ğŸ—‘ï¸</text>
          <text>æ¸…ç©ºè´­ç‰©è½¦</text>
        </view>
      </view>
      <scroll-view class="cart-panel-list" scroll-y>
        <block wx:for="{{categories}}" wx:for-item="category" wx:for-index="categoryIndex">
          <block wx:for="{{allDishes[categoryIndex]}}" wx:key="id" wx:if="{{item.count > 0}}">
            <view class="cart-panel-item">
              <text class="cart-item-name">{{item.name}}</text>
              <view class="cart-item-control">
                <text class="cart-item-price">Â¥{{item.price}}</text>
                <view class="dish-control">
                  <view class="minus" bindtap="minusCount" data-id="{{item.id}}">-</view>
                  <text class="count">{{item.count}}</text>
                  <view class="plus" bindtap="addCount" data-id="{{item.id}}">+</view>
                </view>
              </view>
            </view>
          </block>
        </block>
      </scroll-view>
    </view>
  </view>

  <!-- è´­ç‰©è½¦æ  -->
  <view class="cart-bar {{totalCount > 0 ? 'active' : ''}}" bindtap="toggleCartPanel">
    <view class="cart-info" catchtap="toggleCartPanel">
      <view class="cart-icon">
        <image src="/images/icons/cart.png"></image>
        <text class="cart-count" wx:if="{{totalCount > 0}}">{{totalCount}}</text>
      </view>
      <text class="total-price">Â¥{{totalPrice}}</text>
    </view>
    <view class="submit-btn" catchtap="goToCheckout">å»ç»“ç®—</view>
  </view>

  <!-- é®ç½©å±‚ -->
  <view class="mask" wx:if="{{showCartPanel}}" bindtap="hideCartPanel"></view>
</view>
